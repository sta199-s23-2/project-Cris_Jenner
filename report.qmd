---
title: "After accounting for state, which variable accounts for the most variability in median household income?"
subtitle: "Report"
format: html
editor: visual
execute:
  echo: false
---

***Introduction***

There are persistent problems and injustices in the United States surrounding income inequality. For our research project, we are going to examine the question: After accounting for state, which variable accounts for the most variability in median household income? In order to investigate this question, we will look at data coming from over 3,000 counties and all 50 states in the United States. In many cases, income levels and location (such as more vulnerable states and counties) are very interrelated for families in terms of accessing improved educational opportunities and resources, causing or exacerbating a vicious cycle that can be hard to break. In America, there are many root causes that contribute to such a cycle, and it is important they are clearly researched and evaluated, so changes can start to be made to states and therefore, populations that need them most. There are many factors that can influence one's career outcomes, but some particularly important ones that we are going to focus on are education level, ethnicity, gender, and age. According to the APLU, people who hold college degrees are twice as likely to get a job and make around an extra \$1.2 million over the course of their life (APLU). Black or Latino families make around 50% of what white households do, according to the Federal Reserve Board (Federal Reserve Board). The gender pay gap still persists, with women earning an average of 82% of what men do (PEW Research Center). Income can also vary with age, as people's income typically peaks right before retirement (so around age 65). It is also important to note that on the state level, various factors such as funding per county and class disparities impact income inequality as well, which is something that we could observe beyond this project after identifying states that are particularly vulnerable. There are intersections in everyone's identities and, thereby the states' identities as well, and when combined, can have even greater impacts on career outcomes, so knowing which specific identities are most vulnerable is also a key step to making actionable change. We believe states with residents with higher levels of education, a higher white population, and more males will have high median household incomes. Since this data has been gathered by the US Census Bureau, a government organization, there should be no ethical concerns. They adhere to strict privacy policy guidelines to ensure a confidential, respectful, and transparent experience for participants when collecting data (United States Census Bureau).

<https://www.census.gov/about/policies/privacy/data_stewardship/our_privacy_principles.html>

<https://www.aplu.org/our-work/4-policy-and-advocacy/publicuvalues/employment-earnings/#:~:text=The%20evidence%20that%20a%20college,on%20average%20over%20their%20lifetime>.

<https://www.federalreserve.gov/econres/notes/feds-notes/wealth-inequality-and-the-racial-wealth-gap-20211022.html#:~:text=In%20the%20United%20States%2C%20the,percent%20as%20much%20net%20wealth>.

<https://www.pewresearch.org/fact-tank/2023/03/01/gender-pay-gap-facts/#:~:text=The%20gender%20gap%20in%20pay,%2D%20and%20part%2Dtime%20workers>.

\
***Data***

The dataset we are analyzing is from The Collection of Really Great, Interesting, Situated Datasets (CORGIS) Project. The data was collected from 2010 to 2019 by the United States Census Bureau. It should be noted that some of the estimates came from sample data. The dataset includes a wide variety of observations for various counties in the United States. In order to best serve our research question, we will focus on the statistics such as education level, ethnicity, age, and gender as well as respective state and median household income. The data is largely qualitative and in terms of what percentage of the county fits a certain description such as being a high school graduate or white, although there are some quantitative variables such as state and county.\

***Methodology***

We began by loading in the necessary libraries and obtained the county demographic data.

```{r}
#| label: load-pkgs
#| message: false
#| warning: false

library(tidyverse)
library(usmap)
library(geofacet)
library(tidymodels)
```

```{r}
#| label: load-data-2
#| message: false
#| warning: false

counties <- read_csv("data/county_demographics.csv")
```

*Renaming Variables*

We renamed our variables of interest because our dataset's variables were too long. We focused on the variables of median household income ("income"), the percentage of the county that had a bachelor's degree or higher ("education"), the percentage of the county that was female ("percent_female"), the percentage of the county that was 65 years and older ("age"), and the percentage of the county that was White and not Hispanic ("percentage_white").

```{r}
#| label: changing variables

filtered_counties <- counties |>
  rename(income = `Income.Median Houseold Income`,
         education = `Education.Bachelor's Degree or Higher`,
         percent_female = `Miscellaneous.Percent Female`,
         age = `Age.Percent 65 and Older`,
         percentage_white = `Ethnicities.White Alone\t not Hispanic or Latino`) |>
  select(County, State, income, education, percent_female, age, percentage_white)

```

*Graph of Income Versus State*

To start our exploratory data analysis, we wanted to see how income varied across states. So, we made a heat map of the United States with different colors denoting different median household income levels.

```{r}
#| label: income
#| message: false
#| warning: false

statepop <- statepop

state_data <- counties |>
  group_by(State) |>
  summarize(median_income = median(`Income.Median Houseold Income`))

maps_dataframe <- full_join(statepop, state_data, by = c("abbr" = "State")) 

plot_usmap(data = maps_dataframe,
           values = "median_income",
           labels = TRUE) +
  labs(fill = "Median Household Income (in Thousands)", 
       title = "Household Incomes Per State") +
  scale_fill_viridis_c(label = scales::label_number_si(scale = 0.001)) +
  theme(legend.position = "bottom")

```

We first summarized our data (finding median income) and manipulated it (using full_join) in order to create a Choropleth map of the US. Each state is colored based on median household income. We chose to create these maps as they helped us visualize general geographic patterns within the US based on the spectrum of colors by state. The states that are colored darker (such as purple and blue) have lower median household incomes, whereas those that are lighter colors (like yellow and green) are states that have higher median household incomes.

This visualization allows us to see that there are greater income disparities in the southeatern states, especially Mississippi, and that there is a generally higher median household income in the western and northeastern states, especially New Jersey.

*Graphs of Income Versus Different Variables*

Income vs. Education Level

```{r}
#| label: income-education
#| message: false
#| warning: false

filtered_counties |>
  ggplot(
    aes(x = education, y = income)) +
  geom_point() +
  labs(x = "Median Education Level Per County",
       y = "Median Household Income Per County in Thousands",
       title = "Median Household Incomes Versus 
       Education Levels") +
  geom_smooth(method = "lm" , se = F) +
  scale_y_continuous(labels = scales::comma_format(scale = 0.001))

```

The line of best fit of this scatter plot suggests a moderately strong, positive correlation between median education level per county and median household income per county in thousands.

Income vs. Percent Female

```{r}
#| label: income-percent-female
#| message: false
#| warning: false

filtered_counties |>
  ggplot(
    aes(x = percent_female, y = income)) +
  geom_point() +
  labs(x = "Female Percentages Per County",
       y = "Median Household Income Per County in Thousands",
       title = "Median Household Incomes Versus 
       Female Percentages") +
  geom_smooth(method = "lm" , se = F) +
  scale_y_continuous(labels = scales::comma_format(scale = 0.001))

```

The line of best fit of this scatter plot suggests no correlation, or an extremely weak positive correlation, between female percentages per county and median household income per county in thousands.

Income vs. Age 65 and Older

```{r}
#| label: income-age
#| message: false
#| warning: false

filtered_counties |>
  ggplot(
    aes(x = percent_female, y = income)) +
  geom_point() +
  labs(x = "Percent Aged 65 and Older Per County",
       y = "Median Household Income Per County in Thousands",
       title = "Median Household Incomes Versus 
       Age 65 and Older") +
  geom_smooth(method = "lm" , se = F) + 
  scale_y_continuous(labels = scales::comma_format(scale = 0.001))

```

The line of best fit of this scatter plot suggests no correlation, or an extremely weak positive correlation, between percent aged 65 and older per county and median household income per county in thousands.

Income vs. Percentage White

```{r}
#| label: income-ethnicity-white
#| message: false
#| warning: false

filtered_counties |>
  ggplot(
    aes(x = percentage_white, y = income)) +
  geom_point() +
  labs(x = "White Percentage Per County",
       y = "Median Household Income Per County (in Thousands)",
       title = "Median Household Incomes Versus 
       White Percentage") +
  geom_smooth(method = "lm" , se = F) +
  scale_y_continuous(labels = scales::comma_format(scale = 0.001))

```

The line of best fit of this scatter plot suggests a very weak positive correlation between white percentage per county and median household income per county in thousands.

Given the results of these preliminary visuals, it seems as though education will be the variable that accounts for the most variability in median household income.

*Models (Linear Regressions)*

Baseline Model

```{r}
#| label: lin_reg_income_state

model_baseline <- linear_reg() |>
  set_engine("lm") |>
  fit(income ~ State, data = filtered_counties) 

linear_reg() |>
  set_engine("lm") |>
  fit(income ~ State, data = filtered_counties) 

glance(model_baseline)$r.squared
```

Model with State and Education

```{r}
#| label: lin_reg_income_state_and_education

model_with_education <- linear_reg() |>
  set_engine("lm") |>
  fit(income ~ State + education, data = filtered_counties) 

glance(model_with_education)$r.squared
```

Model with State and Percent Female

```{r}
#| label: lin_reg_income_state_and_female

model_with_percent_female <- linear_reg() |>
  set_engine("lm") |>
  fit(income ~ State + percent_female, data = filtered_counties) 

glance(model_with_percent_female)$r.squared

```

Model with State and Age 65 and Older

```{r}
#| label: lin_reg_income_state_and_age

model_with_age <- linear_reg() |>
  set_engine("lm") |>
  fit(income ~ State + age, data = filtered_counties) 

glance(model_with_age)$r.squared
```

Model with State and Percentage White

```{r}
#| label: lin_reg_income_state_and_ethnicity

model_with_ethnicity <- linear_reg() |>
  set_engine("lm") |>
  fit(income ~ State + percentage_white, data = filtered_counties) 

glance(model_with_ethnicity)$r.squared
```

***Results***

First of all, according to the map visualization, median household income levels appear to be the lowest in the southern regions, particularly in the southeast. They tend to be the highest in the northeast and west. This trend is very similar for the map visualization of median education levels, but the difference between the regions is not as extreme. There are very high median education levels in the northeast compared to the rest of the country.

Additionally, within each state's population, there seems to be a lower percent of females in the northwest and west (\~48% to 50%), while there seems to be a higher percent of females comparatively in the east and southeast regions.

The percent elderly in the US among states seems to be very scattered among regions. Among all states, Montana seems to have the greatest elderly population while Utah and Alaska seem to have the lowest. It seems that states in the northwest seem to have the greatest elderly populations, although the correlation among region seems to be weak.

We can see the relationships between income, age, gender, and education below through the following linear regression models.
